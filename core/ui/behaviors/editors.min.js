/*!
 * editors.js - Product & Category editor behaviors
 * Copyright Â© 2008-2010 by Ingenesis Limited
 * Licensed under the GPLv3 {@see license.txt}
 */
;function NestedMenu(b,d,a,f,c,h,e){var g=jQuery,k=this;e||(e={axis:"y"});k.items=h;k.dataname=a;k.index=b;k.element=g('<li><div class="move"></div><input type="hidden" name="'+a.replace("[","-").replace("]","-")+'-sortorder[]" value="'+b+'" class="sortorder" /><input type="hidden" name="'+a+"["+b+'][id]" class="id" /><input type="text" name="'+a+"["+b+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(g(d).children("ul"));k.moveHandle=
k.element.find("div.move");k.sortorder=k.element.find("input.sortorder");k.id=k.element.find("input.id");k.label=k.element.find("input.label");k.deleteButton=k.element.find("button.delete").bind("delete",function(){var a=g(d).find("input.deletes");""!=g(k.id).val()&&a.val(""==a.val()?g(k.id).val():a.val()+","+g(k.id).val());h&&k.itemsElement.remove();k.element.remove()}).click(function(){g(this).trigger("delete")});k.items&&(k.itemsElement="list"==h.type?g("<ul></ul>").appendTo(h.target).hide():g("<li></li>").appendTo(h.target).hide());
k.selected=function(){g(d).find("ul li").removeClass("selected");g(k.element).addClass("selected");h&&(g(h.target).children().hide(),g(k.itemsElement).show())};k.element.click(this.selected).hover(function(){g(this).addClass("hover")},function(){g(this).removeClass("hover")});k.label.mouseup(function(a){this.select()}).focus(function(){g(this).keydown(function(a){a.stopPropagation();13==a.keyCode&&g(this).blur().unbind("keydown")})});k.id.val(k.index);c&&c.id&&k.id.val(c.id);c&&c.name?k.label.val(htmlentities(c.name)):
k.label.val(f+" "+k.index);g(d).children("ul").hasClass("ui-sortable")?g(d).children("ul").sortable("refresh"):g(d).children("ul").sortable(e)}function NestedMenuContent(b,d,a,f){this.contents=jQuery('<textarea name="'+a+"["+b+'][value]" cols="40" rows="7"></textarea>').appendTo(d);f&&f.value&&this.contents.val(htmlentities(f.value))}
function NestedMenuOption(b,d,a,f,c){var h=jQuery,e=this;e.index=h(d).contents().length;e.element=h('<li class="option"><div class="move"></div><input type="hidden" name="'+a+"["+b+"][options]["+this.index+'][id]" class="id" /><input type="text" name="'+a+"["+b+"][options]["+this.index+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(d);e.moveHandle=e.element.find("div.move");e.id=e.element.find("input.id");e.label=e.element.find("input.label");
e.deleteButton=e.element.find("button.delete").click(function(){h(e.element).remove()});e.element.hover(function(){h(this).addClass("hover")},function(){h(this).removeClass("hover")});e.label.click(function(){this.select()}).focus(function(){h(this).keydown(function(a){a.stopPropagation();13==a.keyCode&&h(this).blur().unbind("keydown")})});e.id.val(e.index);c.id&&e.id.val(c.id);c.name&&e.label.val(htmlentities(c.name));c.name||e.label.val(f+" "+(e.index+1))}
function loadVariations(b,d){if(b){var a=jQuery;a.each(b,function(a,c){c&&c.id&&addVariationOptionsMenu(c)});a.each(d,function(a,c){"variation"==c.context&&Pricelines.add(c.options.split(","),c,"#variations-pricing")});Pricelines.updateVariationsUI();a.each(b,function(b,c){c&&c.options&&a.each(c.options,function(a,b){b&&b.id&&"on"==b.linked&&Pricelines.linkVariations(b.id)})})}}
function addVariationOptionsMenu(b){var d=jQuery,a=d("#variations-menu"),f=d("#variations-list");d("#addVariationMenu");var c=d("#addVariationOption"),h=d("#linkOptionVariations"),e=new NestedMenu(variationsidx,a,"meta[options][v]",OPTION_MENU_DEFAULT,b,{target:f,type:"list"},{axis:"y",update:function(){orderOptions(a,f)}});e.addOption=function(a){var b=!1,l,q;a||(a={});a.id?a.id>optionsidx&&(optionsidx=a.id):(b=!0,a.id=optionsidx);l=new NestedMenuOption(e.index,e.itemsElement,"meta[options][v]",
NEW_OPTION_DEFAULT,a);optionsidx++;q=l.id.val();l.linkIcon=d('<span class="shoppui-link"></span>').appendTo(l.moveHandle);l.linked=d('<input type="hidden" name="meta[options][v]['+e.index+"][options]["+l.index+'][linked]" class="linked" />').val(a.linked?a.linked:"off").appendTo(l.element).change(function(){"on"==d(this).val()?l.linkIcon.removeClass("hidden"):l.linkIcon.addClass("hidden")}).change();l.selected=function(){l.element.hasClass("selected")?(f.find("ul li").removeClass("selected"),selectedMenuOption=
!1):(f.find("ul li").removeClass("selected"),d(l.element).addClass("selected"),selectedMenuOption=l);h.change()};l.element.click(l.selected);productOptions[q]=l.label;l.label.blur(function(){updateVariationLabels()});l.deleteButton.unbind("click");l.deleteButton.click(function(){1==e.itemsElement.children().length?deleteVariationPrices([q],!0):deleteVariationPrices([q]);l.element.remove()});b?addVariationPrices():addVariationPrices(q);f.dequeue().animate({scrollTop:f.prop("scrollHeight")-f.height()},
200);l.label.click().focus().select().keydown(function(a){9==(a.keyCode||a.which)&&(a.preventDefault(),l.label.blur(),c.focus())});e.items.push(l)};e.items=[];b&&b.options?d.each(b.options,function(){e.addOption(this)}):(e.addOption(),e.addOption());e.itemsElement.sortable({axis:"y",update:function(){orderVariationPrices()}});e.element.unbind("click",e.click).click(function(){e.selected();d(c).unbind("click").click(e.addOption)});optionMenus[variationsidx++]=e;e.deleteButton.unbind("click").click(function(){var a=
[];d(e.itemsElement).find("li").not(".ui-sortable-helper").find("input.id").each(function(b,c){a.push(d(c).val())});deleteVariationPrices(a,!0);d(this).trigger("delete")});b||(f.dequeue().animate({scrollTop:f.attr("scrollHeight")-f.height()},200),e.label.click().focus().select().keydown(function(a){9==(a.keyCode||a.which)&&(a.preventDefault(),c.focus())}))}
function buildVariations(){var b=jQuery,d,a,f,c=[],h=b("#variations-list ul"),e=h.length-1,g=Array(h.length),k=Array(h.length),l=0;h.each(function(a,c){k[a]=b(c).children().length;l=0==l?b(c).children().length:l*b(c).children().length;g[a]=0});for(d=0;d<l;d++){for(a=0;a<h.length;a++)f=b(h[a]).children("li").not(".ui-sortable-helper").children("input.id"),c[d]?c[d].push(b(f[g[a]]).val()):c[d]=[b(f[g[a]]).val()];if(++g[e]>=k[e])for(a=e;-1<a;a--)g[a]<k[a]||(g[a]=0,-1<a-1&&g[a-1]++)}return c}
function addVariationPrices(b){if(!b){b=jQuery;var d,a,f=buildVariations(),c=b("#variations-pricing"),h=b(c).children(),e=!1;b(f).each(function(b,c){d=xorkey(c);a=xorkey(c.slice(0,c.length-1));""==a&&(a=-1);Pricelines.row[d]||(Pricelines.row[a]?(Pricelines.row[d]=Pricelines.row[a],delete Pricelines.row[a],Pricelines.row[d].setOptions(c)):(0==h.length?Pricelines.add(c,{context:"variation"},"#variations-pricing"):Pricelines.add(c,{context:"variation"},Pricelines.row[xorkey(f[b-1])].row,"after"),e=!0))});
e&&Pricelines.updateVariationsUI()}}
function deleteVariationPrices(b,d){var a=jQuery,f=buildVariations(),c=!1,h,e,g,k,l;a(f).each(function(f,p){e=xorkey(p);for(h=0;h<b.length;h++)-1!=p.indexOf(b[h])&&(g=[],a(p).each(function(a,c){c!=b[h]&&g.push(c)}),k=xorkey(g),d&&!Pricelines.row[k]?(0!=k?Pricelines.row[k]=Pricelines.row[e]:Pricelines.row[e].row.remove(),delete Pricelines.row[e],Pricelines.row[k]&&(Pricelines.row[k].setOptions(g),c=!0)):Pricelines.row[e]&&(l=a("#priceid-"+Pricelines.row[e].id).val(),""==a("#deletePrices").val()?a("#deletePrices").val(l):
a("#deletePrices").val(a("#deletePrices").val()+","+l),Pricelines.remove(e)))});c&&Pricelines.updateVariationsUI()}function optionMenuExists(b){if(!b)return!1;var d=jQuery,a=!1;d.each(optionMenus,function(f,c){if(c&&d(c.label).val()==b)return a=f});return optionMenus[a]?optionMenus[a]:a}function optionMenuItemExists(b,d){if(!b||!b.items||!d)return!1;var a=jQuery,f=!1;a.each(b.items,function(c,b){if(b&&a(b.label).val()==d)return f=!0});return f}
function updateVariationLabels(){var b=jQuery,d=buildVariations();b(d).each(function(a,b){var c=xorkey(b);Pricelines.row[c]&&Pricelines.row[c].updateLabel()})}function orderOptions(b,d){var a=jQuery;a(b).find("ul li").not(".ui-sortable-helper").find("input.id").each(function(b,c){c&&a(optionMenus[a(c).val()].itemsElement).appendTo(d)});orderVariationPrices()}
function orderVariationPrices(){var b=jQuery,d,a=buildVariations();b(a).each(function(a,b){d=xorkey(b);0<d&&Pricelines.row[d]&&Pricelines.reorderVariation(d,b)});Pricelines.updateVariationsUI("tabs")}function xorkey(b){b instanceof Array||(b=[b]);for(var d=0,a=0;a<b.length;a++)d^=7001*b[a];return d}
function variationsToggle(){var b=jQuery,d=b(this),a=b("#variations"),b=b("#product-pricing");d.prop("checked")?(Pricelines.row[0]&&Pricelines.row[0].disable(),b.hide(),a.show()):(a.hide(),b.show(),Pricelines.row[0]&&Pricelines.row[0].enable())}function addonsToggle(){var b=jQuery,d=b(this),b=b("#addons");d.prop("checked")?b.show():b.hide()}function clearLinkedIcons(){jQuery("#variations-list input.linked").val("off").change()}
function linkVariationsButton(){var b=jQuery;selectedMenuOption?"off"==selectedMenuOption.linked.val()?(Pricelines.allLinked()&&(clearLinkedIcons(),Pricelines.unlinkAll()),selectedMenuOption.linked.val("on").change(),Pricelines.linkVariations(selectedMenuOption.id.val())):(selectedMenuOption.linked.val("off").change(),Pricelines.unlinkVariations(selectedMenuOption.id.val())):(clearLinkedIcons(),Pricelines.allLinked()?Pricelines.unlinkAll():Pricelines.linkAll());b(this).change()}
function linkVariationsButtonLabel(){var b=jQuery;selectedMenuOption?"on"==selectedMenuOption.linked.val()?b(this).find("small").html(" "+UNLINK_VARIATIONS):b(this).find("small").html(" "+LINK_VARIATIONS):Pricelines.allLinked()?b(this).find("small").html(" "+UNLINK_ALL_VARIATIONS):b(this).find("small").html(" "+LINK_ALL_VARIATIONS)}
function loadAddons(b,d){var a=jQuery;b&&(a.each(b,function(a,b){newAddonGroup(b)}),a.each(d,function(a,b){"addon"==b.context&&Pricelines.add(b.options,this,"#addon-pricegroup-"+addonOptionsGroup[b.options])}),Pricelines.updateVariationsUI())}
function newAddonGroup(b){var d=jQuery,a=d("#addon-menu"),f=d("#addon-list"),c=d("#newAddonGroup"),h=d("#addAddonOption"),e=addon_group_idx,g=new NestedMenu(e,a,"meta[options][a]",ADDON_GROUP_DEFAULT,b,{target:f,type:"list"},{axis:"y",update:function(){orderAddonGroups()}});g.itemsElement.attr("id","addon-group-"+e);g.pricegroup=d('<div id="addon-pricegroup-'+e+'" />').appendTo("#addon-pricing");g.pricegroupLabel=d("<label />").html("<h4>"+g.label.val()+"</h4>").prependTo(g.pricegroup);g.updatePriceLabel=
function(){g.pricegroupLabel.html("<h4>"+g.label.val()+"</h4>")};g.label.blur(g.updatePriceLabel);g.addOption=function(a){var b=!1,c,e;a||(a={});a.id?a.id>addonsidx&&(addonsidx=a.id):(b=!0,a.id=addonsidx);c=new NestedMenuOption(g.index,g.itemsElement,"meta[options][a]",NEW_OPTION_DEFAULT,a);addonsidx++;e=c.id.val();c.selected=function(){c.element.hasClass("selected")?(f.find("ul li").removeClass("selected"),selectedMenuOption=!1):(f.find("ul li").removeClass("selected"),d(c.element).addClass("selected"),
selectedMenuOption=c)};c.element.click(c.selected);productAddons[e]=c.label;c.label.blur(function(){Pricelines.row[e].updateLabel()});c.deleteButton.unbind("click");c.deleteButton.click(function(){var a=Pricelines.row[e].data.id,b=d("#deletePrices");a&&(""==b.val()?b.val(a):b.val(b.val()+","+a));Pricelines.row[e].row.remove();c.element.remove()});b&&Pricelines.add(e,{context:"addon"},g.pricegroup);addonOptionsGroup[e]=g.index;g.items.push(c);f.dequeue().animate({scrollTop:f.attr("scrollHeight")-f.height()},
200);c.label.click().focus().select().keydown(function(a){9==(a.keyCode||a.which)&&(a.preventDefault(),c.label.blur(),h.focus())})};g.items=[];b&&b.options?d.each(b.options,function(){g.addOption(this)}):(g.addOption(),g.addOption());g.itemsElement.sortable({axis:"y",update:function(){orderAddonPrices(g.index)}});g.element.unbind("click",g.click);g.element.click(function(){g.selected();d(h).unbind("click").click(g.addOption)});addonGroups[addon_group_idx++]=g;g.deleteButton.unbind("click").click(function(){d("#addon-list #addon-group-"+
g.index+" li").not(".ui-sortable-helper").find("input.id").each(function(a,b){var c=d(b).val(),e,g=d("#deletePrices");Pricelines.row[c]&&((e=Pricelines.row[c].data.id)&&(""==g.val()?g.val(e):g.val(g.val()+","+e)),Pricelines.row[c].row.remove())});g.deleteButton.trigger("delete");g.pricegroup.remove();g.element.remove()});b||(a.dequeue().animate({scrollTop:a.attr("scrollHeight")-a.height()},200),g.label.click().focus().select().keydown(function(a){9==(a.keyCode||a.which)&&(a.preventDefault(),g.label.blur(),
c.focus())}))}function orderAddonGroups(){var b=jQuery,d;b("#addon-menu ul li").not(".ui-sortable-helper").find("input.id").each(function(a,f){d=addonGroups[b(f).val()];d.pricegroup.appendTo("#addon-pricing")})}function orderAddonPrices(b){var d=jQuery,a=addonGroups[b];d("#addon-list #addon-group-"+a.index+" li").not(".ui-sortable-helper").find("input.id").each(function(b,c){Pricelines.reorderAddon(d(c).val(),a.pricegroup)})}
function readableFileSize(b){b*=1;var d=0;if(0==b)return b;for(;1E3<b;)b/=1024,d++;return b.toFixed(2)+" "+["bytes","KB","MB","GB"][d]}
function addDetail(b){var d=jQuery,a,f,c=d("#details-menu");f=d("#details-list");var h=detailsidx++,h=new NestedMenu(h,c,"details","Detail Name",b,{target:f});if(b&&b.options){f=d('<select name="details['+h.index+'][value]"></select>').appendTo(h.itemsElement);d("<option></option>").appendTo(f);for(a in b.options)d("<option>"+b.options[a].name+"</option>").appendTo(f);b&&b.value&&f.val(htmlentities(b.value))}else h.item=new NestedMenuContent(h.index,h.itemsElement,"details",b);if(!b||b.add)h.add=
d('<input type="hidden" name="details['+h.index+'][new]" value="true" />').appendTo(h.element),c.dequeue().animate({scrollTop:c.attr("scrollHeight")-c.height()},200),h.label.click().focus().select(),h.item&&h.item.contents.keydown(function(a){9==(a.keyCode||a.which)&&(a.preventDefault(),d("#addDetail").focus())})}
function ImageUploads(b,d){function a(){0<c("#lightbox li").size()&&c("#lightbox").sortable({opacity:.8})}function f(a){a.hide();a.parent().hover(function(){a.show()},function(){a.hide()});a.click(function(){if(confirm(DELETE_IMAGE_WARNING)){var b="<"==a.val().substr(0,1)?a.find("input[name=ieisstupid]").val():a.val(),d=c("#deleteImages"),e=d.val();d.val(""==e?b:e+","+b);c("#confirm-delete-images").show();a.parent().fadeOut(500,function(){c(this).remove()})}})}var c=jQuery,h,e={button_text:ADD_IMAGE_BUTTON_TEXT,
button_text_style:'.buttonText{text-align:center;font-family:"Lucida Grande","Lucida Sans Unicode",Tahoma,Verdana,_sans;font-size:9px;color:#333333;}',button_text_top_padding:3,button_height:"22",button_width:"100",button_image_url:uidir+"/icons/buttons.png",button_placeholder_id:"swf-uploader-button",upload_url:ajaxurl,flash_url:uidir+"/behaviors/swfupload/swfupload.swf",file_queue_limit:0,file_size_limit:filesizeLimit+"b",file_types:"*.jpg;*.jpeg;*.png;*.gif",file_types_description:"Web-compatible Image Files",
file_upload_limit:filesizeLimit,post_params:{action:"shopp_upload_image",parent:b,type:d},swfupload_loaded_handler:function(){c("#browser-uploader").hide();h.loaded=!0},file_queue_error_handler:function(a,b,c){b==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED?alert("You selected too many files to upload at one time. "+(0===c?"You have reached the upload limit.":"You may upload "+(1<c?"up to "+c+" files.":"only one file."))):alert(c)},file_dialog_complete_handler:function(a,b){try{this.startUpload()}catch(c){this.debug(c)}},
upload_start_handler:function(a){this.targetHolder=c('<li class="image uploading"><input type="hidden" name="images[]" /><div class="progress"><div class="bar"></div><div class="gloss"></div></div></li>').appendTo(c("#lightbox"));this.progressBar=this.targetHolder.find("div.bar");this.sorting=this.targetHolder.find("input")},upload_progress_handler:function(a,b,c){this.progressBar.animate({width:Math.ceil(b/c*76)+"px"},100)},upload_error_handler:function(a,b,c){},upload_success_handler:function(b,
d){var e=!1,h,p,m=this.targetHolder;try{e=c.parseJSON(d)}catch(t){return m.remove(),alert(d),!1}if(!e.id)return m.remove(),e.error?alert(e.error):alert(UNKNOWN_UPLOAD_ERROR),!0;m.attr({id:"image-"+e.id});this.sorting.val(e.id);h=c('<img src="?siid='+e.id+'" width="96" height="96" class="handle" />').appendTo(m).hide();p=c('<button type="button" name="deleteImage" value="'+e.id+'" class="delete"><span class="shoppui-minus"></span></button>').appendTo(m).hide();a();this.progressBar.animate({width:"76px"},
250,function(){c(this).parent().fadeOut(500,function(){c(this).remove();c(h).fadeIn("500");f(p)})})},custom_settings:{loaded:!1,targetHolder:!1,progressBar:!1,sorting:!1},prevent_swf_caching:c.ua.msie,debug:imageupload_debug};flashuploader&&(h=new SWFUpload(e));c("#image-upload").upload({name:"Filedata",action:ajaxurl,params:{action:"shopp_upload_image",type:d},onSubmit:function(){this.targetHolder=c('<li id="image-uploading"><input type="hidden" name="images[]" value="" /><div class="progress"><div class="bar"></div><div class="gloss"></div></div></li>').appendTo("#lightbox");
this.progressBar=this.targetHolder.find("div.bar");this.sorting=this.targetHolder.find("input")},onComplete:function(a){var b=!1,e,d,h=this.targetHolder;try{b=c.parseJSON(a)}catch(m){b.error=a}if(!b||!b.id)return h.remove(),b.error?alert(b.error):alert(UNKNOWN_UPLOAD_ERROR),!1;h.attr({id:"image-"+b.id});this.sorting.val(b.id);e=c('<img src="?siid='+b.id+'" width="96" height="96" class="handle" />').appendTo(h).hide();d=c('<button type="button" name="deleteImage" value="'+b.src+'" class="delete"><span class="shoppui-minus"></span></button>').appendTo(c(h)).hide();
c(this.progressBar).animate({width:"76px"},250,function(){c(this).parent().fadeOut(500,function(){c(this).remove();c(e).fadeIn("500");f(d)})})}});c(document).load(function(){h.loaded||c("#product-images .swfupload").remove()});a();c("#lightbox li").each(function(){c(this).dblclick(function(){var a=c(this).attr("id")+"-details",b=c("#"+a),e=b.find("input[type=hidden]").val(),a=b.find("img"),d=b.find("input.imagetitle"),h=b.find("input.imagealt"),f=b.find("input.imagecropped"),b=c('<div class="image-details-editor"><div class="details-editor"><img class="thumb" width="96" height="96" /><div class="details"><p><label>'+
IMAGE_DETAILS_TITLE_LABEL+': </label><input type="text" name="title" /></p><p><label>'+IMAGE_DETAILS_ALT_LABEL+': </label><input type="text" name="alt" /></p></div></div><div class="cropping"><p class="clear">'+IMAGE_DETAILS_CROP_LABEL+': <select name="cropimage"><option></option></select></p><div class="cropui"></div><br class="clear"/></div><input type="button" class="button-primary alignright" value="&nbsp;&nbsp;'+IMAGE_DETAILS_DONE+'&nbsp;&nbsp;" /></div>');b.find("img").attr("src",a.attr("src"));
var t=b.find("input[name=title]").val(d.val()).change(function(){d.val(t.val())}),r=b.find("input[name=alt]").val(h.val()).change(function(){h.val(r.val())});b.find("input[type=button]").click(function(){c.colorbox.close()});var a=b.find("div.cropping").hide(),u=b.find("div.cropui"),n=b.find("select[name=cropimage]").change(function(){if(""==n.val())u.empty(),c.colorbox.resize();else{var a=n.val().split(":"),b=f.filter("input[alt="+n.val()+"]").val().split(",");u.empty().scaleCrop({imgsrc:"?siid="+
e,target:{width:parseInt(a[0],10),height:parseInt(a[1],10)},init:{x:parseInt(b[0],10),y:parseInt(b[1],10),s:new Number(b[2])}}).ready(function(){c.colorbox.resize({innerWidth:parseInt(a[0],10)+125})}).bind("change.scalecrop",function(a,b){b.s||(b.s=1);b&&f.filter("input[alt="+n.val()+"]").val(b.x+","+b.y+","+b.s)})}});0<f.size()&&(f.each(function(a,b){var e=c(b).attr("alt");c('<option value="'+e+'">'+(a+1)+": "+e.replace(":","&times;")+"</option>").appendTo(n)}),a.show());c.colorbox({title:IMAGE_DETAILS_TEXT,
html:b})});f(c(this).find("button.delete"))})}
jQuery.fn.FileChooser=function(b,d){var a=jQuery,f=a("#chooser"),c=f.find(".fileimport"),h=f.find(".status"),e=a("#attach-file"),g=a("#download_path-"+b),k=a("#download_file-"+b),l=a("#file-"+b),q=0;this.line=b;this.status=d;f.unbind("change").on("change",".fileimport",function(b){h.attr("class","status").addClass("shoppui-spinner shoppui-spinfx shoppui-spinfx-steps8");a.ajax({url:fileverify_url+"&action=shopp_verify_file&t=download",type:"POST",data:"url="+c.val(),timeout:1E4,dataType:"text",success:function(a){h.attr("class",
"status");if("OK"==a)return h.addClass("shoppui-ok-sign");"NULL"==a&&h.attr("title",FILE_NOT_FOUND_TEXT);"ISDIR"==a&&h.attr("title",FILE_ISDIR_TEXT);"READ"==a&&h.attr("title",FILE_NOT_READ_TEXT);h.addClass("shoppui-warning-sign")}})});c.unbind("keydown").unbind("keypress").suggest(sugg_url+"&action=shopp_storage_suggestions&t=download",{delay:500,minchars:3,multiple:!1,onSelect:function(){c.trigger("change")}});a(this).click(function(){fileUploads.updateLine(b,d);h.attr("class","status");e.unbind("click").click(function(){a.colorbox.hide();
var e=c.val(),d=function(a){if(!a.name)return $this.attr("class","");l.attr("class","file").html('<span class="icon shoppui-file '+a.mime.replace("/"," ")+'"></span>'+a.name+"<br /><small>"+readableFileSize(a.size)+"</small>");g.val(a.path);k.val(a.name);c.val("").attr("class","fileimport")},h=function(){var c=l.find("div.progress"),e=c.find("div.bar"),c=c.outerWidth(),f=a("#import-file-"+b).get(0).contentWindow,g=f.importProgress,k=f.importFile;if(void 0!==k){if(k.error)return l.attr("class","error").html("<small>"+
k.error+"</small>");if(!k.path)return l.attr("class","error").html("<small>"+FILE_UNKNOWN_IMPORT_ERROR+"</small>");if(k.stored)return d(k);savepath=k.path.split("/")}g||(g=0);if(0===g&&60<q++)return l.attr("class","error").html("<small>"+FILE_UNKNOWN_IMPORT_ERROR+"</small>");e.animate({width:Math.ceil(g*c)+"px"},100);1==g?e&&e.css({width:"100%"}).fadeOut(500,function(){d(k)}):setTimeout(h,100)};setTimeout(h,100);l.attr("class","").html('<div class="progress"><div class="bar"></div><div class="gloss"></div></div><iframe id="import-file-'+
b+'" width="0" height="0" src="'+fileimport_url+"&action=shopp_import_file&url="+e+'"></iframe>')})});a(this).colorbox({title:"File Selector",innerWidth:"360",innerHeight:"140",inline:!0,href:f})};
function FileUploader(b,d){var a=jQuery,f=this;f.swfu=!1;f.settings={button_text:'<span class="button">'+UPLOAD_FILE_BUTTON_TEXT+"</span>",button_text_style:'.button { text-align: center; font-family:"Lucida Grande","Lucida Sans Unicode",Tahoma,Verdana,sans-serif; font-size: 9px; color: #333333; }',button_text_top_padding:3,button_height:"22",button_width:"100",button_image_url:uidir+"/icons/buttons.png",button_placeholder_id:b,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE,flash_url:uidir+"/behaviors/swfupload/swfupload.swf",
upload_url:ajaxurl,file_queue_limit:1,file_size_limit:filesizeLimit+"b",file_types:"*.*",file_types_description:"All Files",file_upload_limit:filesizeLimit,post_params:{action:"shopp_upload_file"},swfupload_loaded_handler:function(){a(d).hide();this.loaded=!0},file_queue_error_handler:function(a,b,e){b==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED?alert("You selected too many files to upload at one time. "+(0===e?"You have reached the upload limit.":"You may upload "+(1<e?"up to "+e+" files.":"only one file."))):
alert(e)},file_dialog_complete_handler:function(b,d){a.colorbox.hide();if(b)try{this.startUpload()}catch(e){this.debug(e)}},upload_start_handler:function(b){this.targetCell.attr("class","").html("");a('<div class="progress"><div class="bar"></div><div class="gloss"></div></div>').appendTo(this.targetCell);this.progressBar=this.targetCell.find("div.bar")},upload_progress_handler:function(a,b,e){this.progressBar.animate({width:Math.ceil(b/e*76)+"px"},100)},upload_success_handler:function(b,d){var e=
!1,f=this.targetCell,k=this.targetLine;a.colorbox.close();try{e=a.parseJSON(d)}catch(l){e.error=d}if(!e.id&&!e.name)return f.html(NO_DOWNLOAD),e.error?alert(e.error):alert(UNKNOWN_UPLOAD_ERROR),!1;e.type=e.type.replace(/\//gi," ");a(this.progressBar).animate({width:"76px"},250,function(){a(this).parent().fadeOut(500,function(){a(this).remove();a(f).attr("class","file").html('<div class="icon shoppui-file '+e.type+'"></div>'+e.name+"<br /><small>"+readableFileSize(e.size)+'</small><input type="hidden" name="price['+
k+'][download]" value="'+e.id+'" />')})})},custom_settings:{loaded:!1,targetCell:!1,targetLine:!1,progressBar:!1},prevent_swf_caching:a.ua.msie,debug:fileupload_debug};flashuploader&&(f.swfu=new SWFUpload(f.settings));d.upload({name:"Filedata",action:ajaxurl,params:{action:"shopp_upload_file"},onSubmit:function(){a.colorbox.hide();f.targetCell.attr("class","").html("");a('<div class="progress"><div class="bar"></div><div class="gloss"></div></div>').appendTo(f.targetCell);f.progressBar=f.targetCell.find("div.bar")},
onComplete:function(b){a.colorbox.close();var d=!1,e=f.targetCell;try{d=a.parseJSON(b)}catch(g){d.error=b}if(!d.id&&!d.name)return e.html(NO_DOWNLOAD),d.error?alert(d.error):alert(UNKNOWN_UPLOAD_ERROR),!1;d.type=d.type.replace(/\//gi," ");a(f.progressBar).animate({width:"76px"},250,function(){a(this).parent().fadeOut(500,function(){e.attr("class","file").html('<div class="icon shoppui-file '+d.type+'"></div>'+d.name+"<br /><small>"+readableFileSize(d.size)+'</small><input type="hidden" name="price['+
f.targetLine+'][download]" value="'+d.id+'" />');a(this).remove()})})}});a(f).load(function(){f.swfu&&f.swfu.loaded||a(d).parent().parent().find(".swfupload").remove()});f.updateLine=function(a,b){f.swfu?(f.swfu.targetLine=a,f.swfu.targetCell=b):(f.targetLine=a,f.targetCell=b)}}
function SlugEditor(b,d){var a=jQuery,f=a("#edit-slug-buttons"),c=f.find(".edit"),h=f.find(".view"),e=a("#editor-slug-buttons"),g=e.find(".save"),k=e.find(".cancel"),l=a("#editable-slug-full");this.permalink=function(){var c,p=0,m=a("#editable-slug"),t=m.html(),r=a("#slug_input"),u=r.html(),n=l.html();f.hide();e.show();g.unbind("click").click(function(){var c=m.children("input").val(),g=a("#title").val();a.post(editslug_url+"&action=shopp_edit_slug",{id:b,type:d,slug:c,title:g},function(a){m.html(t);
-1!=a&&(m.html(a),l.html(a),r.val(a));h.attr("href",canonurl+l.html());e.hide();f.show()},"text")});k.unbind("click").click(function(){m.html(t);e.hide();f.show();r.attr("value",u)});for(c=0;c<n.length;++c)"%"==n.charAt(c)&&p++;slug_value=p>n.length/4?"":n;m.html('<input type="text" id="new-post-slug" value="'+slug_value+'" />').children("input").keypress(function(a){var b=a.which;13!=b&&27!=b||a.preventDefault();13==b&&g.click();27==b&&k.click();r.val(this.value)}).focus()};c.click(this.permalink)};